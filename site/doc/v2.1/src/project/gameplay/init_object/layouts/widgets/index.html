<html>
<head>
<meta charset="utf-8"/>
<title>widgets</title>
<link rel="stylesheet" type="text/css" href="style/style.css">
</head>
<body>
<a href="../index.html" style="font-size=2em;color:#f60;border:1px solid #f60;border-radius:5px;">НАВЕРХ</a>
<h1>widgets</h1>
<p>В <hl>$layouts</hl> упоминались идентификаторы виджетов <hl>$catalogue</hl> и <hl>$adPanel</hl>. Значит, мы должны определить их в <hl>$widgets</hl>.</p>
<c>
...
$widgets:{
    $catalogue: {
        $constructor: $TralivaKit.$Strip,
        $options: { <comment>// опции виджета $TralivaKit.$Strip</comment>
            $orient: #e#$TralivaKit__Strip__orient:v##
        },
        <comment>//$substate: '...', // путь в объекте состояния до объекта, описывающего данный виджет</comment>
        $children:{
            $items: { <comment>// здесь идёт описание того, какие дочерние виджеты будут у данного экземпляра виджета $TralivaKit.$Strip</comment>
                $constructor: $TralivaKit.$Button,
                $options: { <comment>// опции отрисовки дочернего виджета в составе родительского (для $TralivaKit.$Strip)</comment>
                    $size: '64px',
                    $clickedVarName: '$subitemClicked',
                    $textVarName: '$name'
                },
                $itemOptions:{ <comment>// опции самого дочернего виджета (для $TralivaKit.$Button)</comment>
                    '$color': 'red'
                },
                $substate: '$books/$list' <comment>// путь в объекте состояния до массива объектов, описывающих дочерние виджеты</comment>
                <comment>//$itemSubstate: '...' // подсостояние в рамках элемента массива с элементами (для $TralivaKit.$Button)</comment>
            }
        }
    },
    $adPanel: {
        $constructor: $TralivaKit.$Button,
        $options: {
            $bg: '#000',
            $color: '#ffa',
            $text: 'Заказать рекламу',
            $clickedVarName: '$hello'
        },
        $substate: '$ad'
    }
},
...
</c>
<p>Предполагается, что объект состояния имеет следующий вид:</p>
<c>
{
    $ad:{
        $hello: false
    },
    $books:{
        $list:[
            {
                $name: 'first',
                $subitemClicked: false,
            },
            {
                $name: 'second',
                $subitemClicked: false,
            },
            ...
        ]
    }
}
</c>
<p>Здесь у нас <hl>$catalogue</hl> выступает в качестве контейнера виджетов, дочерние виджеты которого создаются и удаляются автоматически в соответствии с содержимым массива в составе объекта состояния <hl>'$books/$list'</hl>.</p>
<p>В приведённом выше примере <hl>$catalogue</hl> определяется как <i>ряд</i>(<hl>$TralivaKit.$Strip</hl>) <i>кнопок</i>(<hl>$TralivaKit.$Button</hl>), расположенных в столбик (<hl>#e#$TralivaKit__Strip__orient:v##</hl>). Поскольку для самого ряда подсостояние не указано, подсостояние для объектов, описывающих кнопки, считается от корня объекта состояния. Если бы для ряда было указано подсостояние, то подсостояние для кнопок считалось бы от подсостояния родительского контейнера виджетов. В приведённом выше примере подсостояния для кнопок имеют следующий вид:</p><c>
(подсостояние ряда(т.е. корень '')) /
 (подсостояние, указанное в описании дочерних элементов родительского ряда ('$books/$list')) /
  (порядковый индекс кнопки) /
   (подсостояние, указанное у кнопки)
</c>
<p>Предположим теперь, что у нас элементом ряда является ряд кнопок. Т.е. мы имеем не ряд кнопок, а ряд рядов кнопок. Тогда подсостояние для вложенного ряда считается подсостояние родительского ряда (т.е. корень), а подстостояния для кнопок имеют следующий вид:</p> <c>
(подсостояние родительского ряда(т.е. корень '')) /
 (подсостояние, указанное в описании дочерних элементов родительского ряда ('$books/$list')) /
  (порядковый индекс вложенного ряда) /
   (подсостояние, указанное у вложенного ряда) /
    (подсостояние, указанное в описании дочерних элементов вложенного ряда) /
     (порядковый индекс кнопки) /
      (подсостояние, указанное у кнопки)
</c>

<p>Для того, чтобы дочерние виджеты у виджетов-контейнеров <comment>(у которых определено свойство $chilldren)</comment>, которые формируются в объекте состояния <comment>(т.е. экземпляр виджета-контейнера пределён в $widgets)</comment>, при любой модификации списка объектов, описывающих дочерние виджеты, не приходилось полностью пересоздавать, для замены отдельных значений в массиве объектов<comment>, описывающих дочерние виджеты,</comment> следует использовать <comment>добавленный в стандарный список</comment> метод <hl>set</hl>:</p>
<c>
var a = [
    {id: 1, ...},
    {id: 2, ...},
    {id: 3, ...},
    {id: 4, ...}
];
a.set(2, {id: 33, ...});
</c>
<p>Применение метода <hl>set</hl> требуется только в том случае, когда по некоторому индексу меняется ссылка на объект. Если были изменены какие-то свойства в самом объекте, описывающем дочерний виджет, вызывать метод <hl>set</hl> для регистрации изменений не надо - при ближайшем вызове <hl>$_registerStateChanges()</hl> метод <hl>$processStateChanges()</hl> будет вызван у всех виджетов, включая все дочерние виджеты.</p>

</body>
</html>
