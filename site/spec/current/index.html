<html>
<head>
<meta charset="utf-8"/>
<title>Спецификация фреймворка Тралива</title>
<link rel="stylesheet" type="text/css" href="style/style.css">
</head>
<body>
<h1>Спецификация фреймворка Тралива</h1>
<p>Версия 3</p>
<p><a href="spec_changes/index.html">Изменения относительно предыдущей версии спецификации</a></p>

<h2>Назначение программы</h2>

<p>Проект Тралива предназначен для упрощения и унификации процесса создания веб-приложений (сайтов) и нативных приложений (графическая часть представлена нативным webview, отбражающим наш web-контент). Тралива должна давать возможность программисту разрабатывать приложения для разных платформ, но сама сборка целевого приложения работает только на платформе Linux. Это допущение сделано для максимального упрощения кода проекта.</p>

Разработка приложения (и/или сайта) включает в себя следующие этапы разрботки:
<ul>
    <li>
        Разработка спецификации. Мы должны выполнить следующие действия:
        <ul>
            <li>
                Убедиться, что под целевые платформы есть сответствующие скрипты кодогенерации. Базовый набор находится по <a href=https://github.com/1024sparrow/traliva_components> адресу</a>.
            </li>
            <li>Экранные формы, описать интерфейс и бизнес-логику програмы. Неободимо определиться с общей стилистикой программы: шрифты, палитра цветов. Необходимо определиться, как графический интерфейс должен выглядеть на разных размеров экранах, на разных платформах (например, сайт и мобильное приложение)</li>
            <li>Выделить компоненты, необходимые для построения графического интерфейса, описать их. Какие параметры задаются на этапе запуска программы, а какие должны иметь возможность меняться в процессе работы приложения.</li>
            <li>Определить единый объект Состояния (иерархическя модель даных), представляющая состояние всей программы. Определить, какие компоненты будут отрисовывать какие подсостояния единого объекта Состояния. Описать необходимые логические компоненты. Определить API работы с нижним уровнем: для сайтов это веб-сервер, для десктопных и мобильных приложений это код приложения (C++)</li>
        </ul>
    </li>
    <li>
        Разработка компонентов. Для запуска, отладки и тестирования отдельных компонентов есть отдельный инструмент (traliva-run-components)
    </li>
    <li>
        Разработка графического интерфейса. Есть возможность запуска графического интрфейса на заглушках API нижнего уровня (traliva-run-bare). Следует обратить внимание на то, что при измении размеров экрана графический интерфейс должен меняться. Можно также сделать адаптивность и по платформе: на разных платформах (например, сайт и мобильное приложение) интерфейс может быть разным
    </li>
    <li>
        Релизация низкоуровнего API для каждой из целевых платформ.
    </li>
</ul>

<h2>Руководство пользователя, или как работать с Тралива</h2>

<h3>Установка Тралива</h3>

<p>Для начала работы с Тралива неоходимо установить себе в оперционную систему (GNU/Linux) утилиту <hl>traliva</hl>. Для этого необходимо выполнить следующие действия:</p>
<ul>
<li>
    Установить все зависимости: git, nodejs, firefox для самого Тралива, зависимости для генерации кода под целевые платформы - см. документацию к соответствующим генераторам.
</li>
<li>
    Скачать репозиторий traliva. Например, в директорию opt в домашней директории (любое место, лишь бы вы по ошибке со временем не удалили, не переместили, не переименовали)
</li>
</ul>
<c>
<prebash>$</prebash> git clone https://github.com/1024sparrow/traliva.git
<prebash>$</prebash> cd traliva/util
<prebash>traliva/util$</prebash> sudo ./install.sh # важно, что запуск из той директории, где этот скрипт находится
</c>
<p> После этого в системе доступна утилита traliva. Справка по работе с этой утилите отображается при запуске с ключом <hl>--help</hl>.  </p>
<p>Утилита traliva позволяет генерировать проекты:</p>
<ul>
<li>traliva. Для этого утилита, собственно, и предназначена</li>
<li>cmake - проект с использованием Qt5</li>
</ul>
<p>После запуска утилита спросит у пользователя название проекта и параметры генерируемого проекта.</p>
<p>Мы будем создавать проект типа traliva, поэтому выполним в консоли команду</p>
<c>
<prebash>$</prebash> traliva init traliva
<prebash>Название вашего проекта (одним словом - это будет частью имён нескольких репозиториев):</prebash> MyApp
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория traliva. "master" или "develop":</prebash> develop
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория https://github.com/1024sparrow/traliva_example.git [default - master]: </prebash>
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория https://github.com/1024sparrow/traliva_kit.git [default - master]: </prebash>
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория https://github.com/1024sparrow/traliva_platforms.git [default - master]: </prebash>
<prebash>...</prebash>
<prebash>Сохраните ссылку на локальную документацию по вашему проекту: file:///home/boris/da/tmp/10612/doc/index.html</prebash>
</c>
<p>Как видите, исходных код для вашего проекта взят из четырёх репозиториев на github-е. Однако вы уже сейчас можете комитить и пушить (<c><prebash>$</prebash> git push</c>), и ваши комиты утелят... в локальную папочку с локально расшаренным репозиторием.</p>
<p>После того, как команда отработала, в текущей директории вы найдёте две директории:</p>
<c>
<prebash>$</prebash> ls
<prebash>MyApp repos</prebash>
</c>
<p>Содержимое локальных репозиториев склонировано из репозиториев Тралива на github-е. Однако, если у вас есть свои ответвления от тех репозиториев (форки), то есть возможность указать местоположение исходных репозиториев. Это использование дополнительных аргументов <hl>--config-gen</hl> и <hl>--config</hl>:</p>
<c>
<prebash>$</prebash> traliva init traliva --config-gen
<prebash># Если указываете путь в файловой системе, то, пожалуйста, указывайте полный путь до репозитория (от корня файловой системы)</prebash>
<prebash>gitpath_traliva=https://github.com/1024sparrow/traliva.git</prebash>
<prebash>gitpath_traliva_kit=https://github.com/1024sparrow/traliva_kit.git</prebash>
<prebash>gitpath_traliva_example=https://github.com/1024sparrow/traliva_example.git</prebash>
<prebash>gitpath_traliva_platforms=https://github.com/1024sparrow/traliva_platforms.git</prebash>
<prebash>$</prebash> traliva init traliva --config-gen &gt; traliva.conf
... (поправьте пути в файле traliva.conf на ваши)
<prebash>$</prebash> traliva init traliva --config traliva.conf
</c>

<p>"<c>git push</c>" отправит ваши локальные комиты в локальный репозиторий, <c>git push parent</c> отправит ваши комиты в родительский репозиторий (на github, если вы не подменяли родительский репозиторий)</p>

<p>Рассмотрим, что в каком репозитории находится:</p>
<ul>
<li>traliva.git (форкается в локальный репозиторий MyApp.git) - исходный код самого фреймворка Тралива. Сюда входят также утилита traliva, документация и содержмое сайта traliva.ru на момент создания проекта</li>
<li>traliva_kit.git (форкается в локальный репозиторий MyApp_kit.git) - библиотека компонентов Тралива. Всякие кнопочки, переключалки, поля ввода, анимированные контейнеры, а также, возможно, логические компоненты для вашего проекта (компонент загрузки контента, компонент воспроизведения аудио и т.д.)</li>
<li>traliva_example.git (форкается в локальный репозиторий MyApp_proj.git) - это репозиторий вашего проекта, где из компонентов собирается проект</li>
<li>traliva_platforms.git (форкается в локальный репозиторий MyApp_platforms.git) - репозиторий со скриптами генерации платформоспецифичного кода (генерация проекта с webview для разных платформ)</li>
</ul>

<h3>Ваш первый проект на Тралива</h3>

<p>Инициализируем проект:</p>
<c>
<prebash>$</prebash> traliva init traliva
<prebash>Название вашего проекта (одним словом - это будет частью имён нескольких репозиториев):</prebash> MyApp
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория traliva. "master" или "develop":</prebash> develop
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория https://github.com/1024sparrow/traliva_example.git [default - master]: </prebash>
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория https://github.com/1024sparrow/traliva_kit.git [default - master]: </prebash>
<prebash>...</prebash>
<prebash>Выберите ветку исходного репозитория https://github.com/1024sparrow/traliva_platforms.git [default - master]: </prebash>
<prebash>...</prebash>
<prebash>Сохраните ссылку на локальную документацию по вашему проекту: file:///home/boris/da/tmp/10612/doc/index.html</prebash>
<prebash>$</prebash> ls
<prebash>MyApp   repos</prebash>
<prebash>$</prebash> cd MyApp
</c>

<p>Сейчас мы имеем код примера. Мы имеем базовый набор компонентов. Этот пример мы можем модифицировать под наши нужды, а недостающие компоненты добавить.</p>
<p>Есть три варианта сборки:</p>
<ul>
<li>Сборка только компонентов и специального инструмента для тестирования компонентов</li>
<li>Сборка только графического интерфейса для запуска в firefox из локальной файловой системы</li>
<li>Сборка только итогового кода под целевые платформы</li>
</ul>
<p>Нас интересует сразу последний вариант: сборка кода под целевые платформы. По умолчанию в этом режиме сборка производится под все платформы, которые есть в репозитории traliva_platforms.git . Для того, чтобы уточнить, под какую платформу надо собрать, необходимо целевую платформу (одну или несколько) указать в файле <hl>src/target_platforms</hl>. Также есть конфигурационный файл <hl>src/config</hl>, в котором задаются такие параметры сжатия веб-контента (убирание комментариев из кода, переименовывание переменных, делать ли весь JS- и CSS-код становится однострочным)</p>
<p>Мы никакие настройки менять не будем, и запустим сборку сразу под все платформы:</p>
<c><prebash>MyApp$</prebash> ./traliva_build_targets.sh</c>
<p>В директории targets находим две диретории: ubuntu_desktop и web_django.</p>
<p>Заходим в ubuntu_desktop, собираем, запускаем, радуемся.</p>

<h3>Исходники проекта. Где чего править.</h3>

<h2>Устройство Тралива</h2>

<p>Весь JS-код, включая код ядра Тралива, код библиотеки компонентов TralivaKit, а также пользовательский код, компилируется. JS, разложенный фрагментами по файлам и директориям, компилируется в JS, разложенный по другим файлам и директориям. Этот компилятор называется <hl>compiler</hl>, он не доступен из командной строки, запускается посредством утилиты traliva. <a href="compiler/index.html">См. описание</a> этого компилятора.</p>

<p>В основе Тралива лежат реализации:</p>
<ul>
<li><a href="RealizationPublisherSubscriber/index.html">паттерна Издатель-Подисчик</a> (у нас подписчик имеет доступ к данным с правами записи).</li>
<li><a href="RealizationDeclarativity/index.html">декларативности в описании проекта</a></li>
</ul>

Утилита <hl>traliva</hl> инициализирует пользовательский проект, исопльзуя следующие репозитории:
<ul>
<li>traliva.git (контент сайта, документация, утилита traliva, ядро JS-кода);</li>
<li>traliva_kit.git (набор компонентов, определяемых пользователем. Это среда разработки и тестирования компонентов для Тралива);</li>
<li>traliva_example.git (простейшее приложение, с которого можно начать свою разработку с возможностью собрать и запустить ещё ничего не правя);</li>
<li>traliva_platforms.git (скрипты генерации кода под разные платформы, т.е. генератор кода проекта, в котором пользователю надо будет реализовать низкоуровневый API).</li>
</ul>




</body>
</html>
