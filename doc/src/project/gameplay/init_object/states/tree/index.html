<html>
<head>
<meta charset="utf-8"/>
<title>tree</title>
<link rel="stylesheet" type="text/css" href="style/style.css">
</head>
<body>
<a href="../index.html" style="font-size=2em;color:#f60;border:1px solid #f60;border-radius:5px;">НАВЕРХ</a>
<h1>tree</h1>
<p>Дерево переходов между URL при изменении объекта состояния.</p>
<h2>Формат дерева</h2>
<p>URL определяется по структуре дерева и по наличию/отсутствию тех или иных подсостояний (свойств у объекта состояния).</p>
<p>Рассмотрим, какие могут быть элементы в URL. Пусть у нас пользователь открыл книгу с id=803, открыл страницу 85, открыл оглавление, а потом вдруг решил, что ему надо залогиниться. URL страницы авторизации будет иметь следующий вид:</p>
<c>https://mysite.ru/book/803/page/85/contents/auth/login</c>
<p>Обратим ваше внимание на то, что пользователь мог открыть и не книгу (у нас может быть, например, вкладка с музыкой для тех, кому не интересно читать книжки), оглавление мог открыть и не открывая книги (когда нет открытой страницы).</p>
<p>Элементы вышеуказанного URL:</p>
<ul>
<li>book с одним параметром (803)</li>
<li>page с одним параметром (85)</li>
<li>contents без парметров</li>
<li>auth</li>
<li>login</li>
</ul>
<p>Дерево переходов у нас имеет следующий вид:</p>
<img src="img.png"/>
<p>В коде это выглядит следующим образом:</p>
<c>
[
    {
        book: {
            d: [
                {
                    page: {...}
                },
                {
                    contents: {...}
                }
            ],
            ...
        },
        books: {...},
        music: {...}
    },
    {
        auth:{
            d: [
                {
                    login: {...}
                },
                {
                    register: {...}
                }
            ],
            ...
        }
    }
]
</c>
<p>Внутри самого узла уже описывается, имеет ли узел парметры и сколько, а также признаки, когда узел должен быть активным.</p>
<h2>Формат узла дерева</h2>
<p>Узел может иметь следующие свойства:</p>
<ul>
<li>default - (boolean, значение по умолчанию - false). Если пользователь перешёл на URL, который по этому дереву заканчивается на узле, у которого есть свойство с default, то URL будет продолжен. У одного узла не может быть более одного свойства с default.</li>
<li>substate - подсостояние (относительно родительского элемента), которое должно быть доступно. Если подсостояние не доступно (или undefined), элемент не будет отображён в URL.</li>
<li>name - если задано, то для того, чтобы узел был отображён в URL, необходимо также, чтобы в вышеуказанном подсостоянии была строка с указанным здесь значением.</li>
<li>*in - функция инициализации состояния. Вызывается, когда пользователь переходит по такому URL.</li>
<li>*out - функция деструкции состояния. Вызывается,  когда пользователь уходит с такого URL.</li>
<li>params - массив подсостояний, в которых хранятся в строковом виде параметры узла. Можно задавать значения по умолчанию через знак '=' (если не указано значение по умолчанию для следующих после {параметром со значением по умолчанию}, таковым считается пустая строка). Значения считываются и записываются в виде строк. Значения по умолчанию могут быть лишь для конечных узлов: для улов дерева, имеющих детей, использование значений по умолчанию недопустимо.</li>
<li>*changed - функция, которая вызывается при изменении параметра(параметров)</li>
<li>d - дочерние узлы (массив)</li>
<li>extender_url - для динамической подгрузки. Сетевой путь (имя) к директории, где лежит код для подгрузки. Подгружаемый код находится <a href="../../../../index.html">в директории children</a>.</li>
<li>extender_slotwidget - для динамической подгрузки. Идентификатор виджета, в который встраивать подгружаемый контент.</li>
<li>extender_loadmode - режим загрузки:<ul>
    <li>отсутствует или undefined (по умолчанию) - грузит по обращению, выгружает по деактивации</li>
    <li>'save' - по обращению грузит и более не выгружает</li>
    <li>'preload' - грузит сразу при старте страницы и более не выгружает</li>
</ul></li>
</ul>
<c>
</c>
</body>
</html>
